<div class="min-h-screen bg-gray-50" *ngIf="state$ | async as state">
    <!-- Page Header -->
    <div class="bg-white border-b border-gray-200 px-4 sm:px-6 lg:px-8 py-4 sm:py-6">
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
            <div>
                <h1 class="text-2xl sm:text-3xl font-bold text-gray-900">Data Ingestion</h1>
                <p class="text-sm sm:text-base text-gray-600 mt-1">Upload and manage your data files</p>
            </div>

            <!-- Reload Button -->
            <button mat-raised-button color="primary" (click)="reloadData()"
                [disabled]="state.isReloading || state.isUploading" class="h-10"
                matTooltip="This resets all data back to the sample CSV file. Any uploaded changes will be lost."
                matTooltipPosition="below">
                <mat-icon class="mr-2">refresh</mat-icon>
                <span *ngIf="!state.isReloading">Reload Starter CSV</span>
                <span *ngIf="state.isReloading">Reloading...</span>
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="px-4 sm:px-6 lg:px-8 py-6 sm:py-8 max-w-4xl mx-auto">
        <!-- Error Alert -->
        <div *ngIf="state.error" class="mb-6 p-4 bg-red-50 border-l-4 border-red-500 rounded">
            <div class="flex items-start gap-3">
                <mat-icon class="text-red-600 flex-shrink-0">error</mat-icon>
                <p class="text-sm text-red-800">{{ state.error }}</p>
            </div>
        </div>

        <!-- Upload Card -->
        <mat-card class="mb-6">
            <div class="p-6">
                <h2 class="text-xl font-semibold text-gray-900 mb-4">Upload File</h2>

                <!-- Drag and Drop Zone -->
                <div class="border-2 border-dashed rounded-lg p-8 text-center transition-all duration-200" [ngClass]="{
            'border-indigo-500 bg-indigo-50': isDragging,
            'border-gray-300 hover:border-indigo-400 hover:bg-gray-50': !isDragging
          }" (dragover)="onDragOver($event)" (dragleave)="onDragLeave($event)" (drop)="onDrop($event)">
                    <mat-icon class="text-6xl text-gray-400 mb-4">cloud_upload</mat-icon>

                    <div *ngIf="!state.selectedFile" class="mb-4">
                        <p class="text-gray-700 font-medium mb-2">Drag and drop your file here</p>
                        <p class="text-sm text-gray-500">or</p>
                    </div>

                    <!-- File Selected -->
                    <div *ngIf="state.selectedFile" class="mb-4">
                        <div
                            class="inline-flex items-center gap-3 bg-white border border-gray-300 rounded-lg px-4 py-3">
                            <mat-icon class="text-indigo-600">insert_drive_file</mat-icon>
                            <div class="text-left">
                                <p class="font-medium text-gray-900">{{ state.selectedFile.name }}</p>
                                <p class="text-sm text-gray-500">{{ formatFileSize(state.selectedFile.size) }}</p>
                            </div>
                            <button mat-icon-button (click)="removeFile()" [disabled]="state.isUploading"
                                class="text-gray-400 hover:text-red-600">
                                <mat-icon>close</mat-icon>
                            </button>
                        </div>
                    </div>

                    <!-- File Input -->
                    <input #fileInput type="file" class="hidden" [accept]="acceptedTypes.join(',')"
                        (change)="onFileSelected($event)" [disabled]="state.isUploading" />

                    <button *ngIf="!state.selectedFile" mat-stroked-button color="primary" (click)="fileInput.click()"
                        [disabled]="state.isUploading" class="mb-4">
                        <mat-icon class="mr-2">folder_open</mat-icon>
                        Browse Files
                    </button>

                    <p class="text-xs text-gray-500 mt-4">
                        Accepted formats: {{ acceptedTypes.join(', ') }} â€¢ Max size: 50MB
                    </p>
                </div>

                <!-- Upload Progress -->
                <div *ngIf="state.uploadProgress && state.isUploading" class="mt-6">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm font-medium text-gray-700">{{ state.uploadProgress.message }}</span>
                        <span class="text-sm font-medium text-indigo-600">{{ state.uploadProgress.progress }}%</span>
                    </div>
                    <mat-progress-bar mode="determinate" [value]="state.uploadProgress.progress"
                        color="primary"></mat-progress-bar>
                </div>

                <!-- Upload Button -->
                <div class="mt-6 flex justify-end">
                    <button mat-raised-button color="primary" (click)="uploadFile()"
                        [disabled]="!state.selectedFile || state.isUploading" class="h-10">
                        <mat-icon class="mr-2">upload</mat-icon>
                        <span *ngIf="!state.isUploading">Upload File</span>
                        <span *ngIf="state.isUploading">Uploading...</span>
                    </button>
                </div>
            </div>
        </mat-card>

        <!-- Instructions Card -->
        <mat-card>
            <div class="p-6">
                <h2 class="text-xl font-semibold text-gray-900 mb-4">Instructions</h2>

                <div class="space-y-4 text-sm text-gray-700">
                    <div class="flex items-start gap-3">
                        <div class="flex-shrink-0 w-6 h-6 rounded-full bg-indigo-100 flex items-center justify-center">
                            <span class="text-xs font-semibold text-indigo-600">1</span>
                        </div>
                        <div>
                            <p class="font-medium text-gray-900">Prepare your file</p>
                            <p class="text-gray-600 mt-1">Ensure your data file is in one of the accepted formats (CSV)
                            </p>
                        </div>
                    </div>

                    <div class="flex items-start gap-3">
                        <div class="flex-shrink-0 w-6 h-6 rounded-full bg-indigo-100 flex items-center justify-center">
                            <span class="text-xs font-semibold text-indigo-600">2</span>
                        </div>
                        <div>
                            <p class="font-medium text-gray-900">Upload your file</p>
                            <p class="text-gray-600 mt-1">Drag and drop or browse to select your file, then click Upload
                            </p>
                        </div>
                    </div>

                    <div class="flex items-start gap-3">
                        <div class="flex-shrink-0 w-6 h-6 rounded-full bg-indigo-100 flex items-center justify-center">
                            <span class="text-xs font-semibold text-indigo-600">3</span>
                        </div>
                        <div>
                            <p class="font-medium text-gray-900">Reload data</p>
                            <p class="text-gray-600 mt-1">After upload, click "Reload Data" to refresh the analytics
                                dashboard</p>
                        </div>
                    </div>
                </div>
            </div>
        </mat-card>
    </div>
</div>